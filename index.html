<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>åŸå¸‚è–èª•åœ°åœ–</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    #map {
      height: 100%;
      width: 100%;
      background: #eee;
    }
  </style>
</head>
<body>

<div id="map"></div>
<div><button id="shareBtn" style="position:absolute; top:10px; left:10px; z-index:5; padding:8px 12px;">
  ç”Ÿæˆåˆ†äº«é€£çµ
</button></div>

<script>
  window.initMap = function () {
    const map = new google.maps.Map(document.getElementById("map"), {
      center: { lat: 25.033964, lng: 121.564468 },
      zoom: 14
    });

    let markers = [];
    let pathLine = null;


//
document.getElementById("shareBtn").addEventListener("click", () => {
  //1.å¦‚æœé‚„æ²’é¸å…©å€‹é»ï¼Œå°±æé†’
  if (markers.length < 2) {
    alert("è«‹å…ˆè¨­å®šèµ·é»å’Œçµ‚é»ï¼");
    return;
  }

  //2.å–å¾—èµ·é»å’Œçµ‚é»åº§æ¨™
  const start = markers[0].getPosition(); // èµ·é» = è–èª•è€äºº
  const end = markers[1].getPosition();   // çµ‚é» = éº‹é¹¿

  //3.ç”Ÿæˆåˆ†äº«ç¶²å€
  const shareUrl = `${window.location.origin}${window.location.pathname}?start=${start.lat()},${start.lng()}&end=${end.lat()},${end.lng()}`;

  //4.ç”¨å°è©±æ¡†è®“ä½¿ç”¨è€…è¤‡è£½
  prompt("åˆ†äº«é€£çµå¦‚ä¸‹ï¼ˆè¤‡è£½çµ¦æœ‹å‹ï¼‰:", shareUrl);
});





    // å‹•ç•«å‡½æ•¸ï¼šè®“ Marker å¾ start ç§»å‹•åˆ° end
    function animateMarker(marker, start, end, duration) {
      const frames = 100;
      let count = 0;
      const deltaLat = (end.lat() - start.lat()) / frames;
      const deltaLng = (end.lng() - start.lng()) / frames;

      const interval = setInterval(() => {
        if (count >= frames) {
          clearInterval(interval);
        } else {
          const lat = start.lat() + deltaLat * count;
          const lng = start.lng() + deltaLng * count;
          marker.setPosition({ lat, lng });
          count++;
        }
      }, duration / frames);
    }

    // é»æ“Šåœ°åœ–äº‹ä»¶
    map.addListener("click", function(event) {
      const lat = event.latLng.lat();
      const lng = event.latLng.lng();
      console.log("ä½ é»çš„ä½ç½®ï¼š", lat, lng);

      // å¦‚æœå·²æœ‰å…©å€‹æ¨™è¨˜ï¼Œé»ç¬¬ä¸‰æ¬¡å°±æ¸…ç©º
      if (markers.length >= 2) {
        markers.forEach(m => m.setMap(null));
        markers = [];
        if (pathLine) {
          pathLine.setMap(null);
          pathLine = null;
        }
      }

      // åœ–æ¨™ URL
      const iconUrl = markers.length === 0
        ? "https://icons.iconarchive.com/icons/artdesigner/christmas/32/santa-icon.png" // ğŸ…
        : "https://icons.iconarchive.com/icons/psdblast/flat-christmas/32/reindeer-deer-icon.png"; // ğŸ¦Œ

      // å»ºç«‹æ¨™è¨˜
      const marker = new google.maps.Marker({
        position: event.latLng,
        map: map,
        icon: {
          url: iconUrl,
          scaledSize: new google.maps.Size(32, 32)
        }
      });
      markers.push(marker);

      // å¦‚æœæœ‰å…©å€‹æ¨™è¨˜ï¼Œç•«è·¯ç·šä¸¦å‹•ç•«ç§»å‹•éº‹é¹¿
      if (markers.length === 2) {
        pathLine = new google.maps.Polyline({
          path: [markers[0].getPosition(), markers[1].getPosition()],
          geodesic: true,
          strokeColor: "#FF0000",
          strokeOpacity: 1.0,
          strokeWeight: 3,
          map: map
        });

        // è®“éº‹é¹¿å¾èµ·é»ç§»å‹•åˆ°çµ‚é»
        const reindeer = markers[1]; // ç¬¬äºŒå€‹æ¨™è¨˜æ˜¯éº‹é¹¿
        const start = markers[0].getPosition();
        const end = markers[1].getPosition();
        reindeer.setPosition(start); // å¾èµ·é»é–‹å§‹
        animateMarker(reindeer, start, end, 3000); // 3ç§’å®Œæˆ
      }
    });
  };
</script>

<!-- Google Maps API -->
<script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAQjNbg6Zn4742aG9zNQc1T7UzK-DcW100&callback=initMap"
  async
  defer
></script>

</body>
</html>
