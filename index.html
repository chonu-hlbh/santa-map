<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>å°åŸå¸‚è–èª•åœ°åœ–</title>
<style>
  html, body { height: 100%; margin: 0; }
  #map { height: 100%; width: 100%; background: #eee; }

  /* æç¤ºæ–‡å­— */
  #hint {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 5;
    background: white;
    padding: 8px 12px;
    border: 1px solid #ccc;
    font-size: 16px;
    font-weight: bold;
    transition: opacity 0.5s;
  }

  /* åˆ†äº«æŒ‰éˆ• */
  #shareBtn {
    position: absolute;
    top: 60px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 5;
    padding: 12px 20px;
    background: #e53935;
    color: white;
    font-size: 18px;
    font-weight: bold;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    display: none;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    transition: background 0.5s, opacity 0.5s;
  }

  #shareBtn:hover { background: #d32f2f; }
</style>
</head>
<body>

<div id="map"></div>
<div id="hint">é»æ“Šè¨­å®šèµ·é» â†’ é»æ“Šè¨­å®šçµ‚é»</div>
<button id="shareBtn">ğŸ åˆ†äº«åœ°åœ–çµ¦æœ‹å‹ ğŸ</button>

<script>
let markers = [];
let pathLine = null;
let colors = ['#e53935','#fdd835','#43a047','#1e88e5'];
let colorIndex = 0;

// ç›´ç·šå‹•ç•«ï¼šéº‹é¹¿å¾èµ·é»ç§»å‹•åˆ°çµ‚é»
function animateMarkerStraight(marker, start, end, duration) {
  const frames = 200;
  let count = 0;
  const latLngs = [];

  for (let i = 0; i <= frames; i++) {
    const lat = start.lat() + (end.lat() - start.lat()) * (i/frames);
    const lng = start.lng() + (end.lng() - start.lng()) * (i/frames);
    latLngs.push(new google.maps.LatLng(lat, lng));
  }

  const interval = setInterval(() => {
    if (count >= latLngs.length) {
      clearInterval(interval);
    } else {
      marker.setPosition(latLngs[count]);
      count++;
    }
  }, duration / frames);
}

window.initMap = function() {
  const map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: 25.033964, lng: 121.564468 },
    zoom: 14
  });

  const hint = document.getElementById("hint");
  const shareBtn = document.getElementById("shareBtn");

  map.addListener("click", function(event) {
    const lat = event.latLng.lat();
    const lng = event.latLng.lng();

    // è¶…éå…©å€‹æ¨™è¨˜æ™‚é‡ç½®
    if (markers.length >= 2) {
      markers.forEach(m => m.setMap(null));
      markers = [];
      if (pathLine) pathLine.setMap(null);
      pathLine = null;
      hint.innerText = "é»æ“Šè¨­å®šèµ·é» â†’ é»æ“Šè¨­å®šçµ‚é»";
      hint.style.opacity = 1;
      shareBtn.style.display = "none";
    }

    const iconUrl = markers.length === 0
      ? "https://icons.iconarchive.com/icons/artdesigner/christmas/32/santa-icon.png"
      : "https://icons.iconarchive.com/icons/psdblast/flat-christmas/32/reindeer-deer-icon.png";

    const marker = new google.maps.Marker({
      position: event.latLng,
      map: map,
      icon: { url: iconUrl, scaledSize: new google.maps.Size(32,32) }
    });
    markers.push(marker);

    if (markers.length === 1) {
      hint.innerText = "é»æ“Šè¨­å®šçµ‚é»";
    } else if (markers.length === 2) {
      hint.style.opacity = 0;

      // é¡¯ç¤ºåˆ†äº«æŒ‰éˆ•
      shareBtn.style.display = "block";
      shareBtn.style.opacity = 0;
      setTimeout(() => shareBtn.style.opacity = 1, 50);

      // å½©è‰²é–ƒå…‰
      setInterval(() => {
        shareBtn.style.background = colors[colorIndex];
        colorIndex = (colorIndex + 1) % colors.length;
      }, 500);

      // ç•«ç›´ç·šè·¯ç·š
      const start = markers[0].getPosition();
      const end = markers[1].getPosition();
      pathLine = new google.maps.Polyline({
        path: [start, end],
        geodesic: true,
        strokeColor: "#FF0000",
        strokeOpacity: 1.0,
        strokeWeight: 3,
        map: map
      });

      // è®“éº‹é¹¿æ²¿ç›´ç·šç§»å‹•
      const reindeer = markers[1];
      reindeer.setPosition(start);
      animateMarkerStraight(reindeer, start, end, 3000);
    }
  });

  // åˆ†äº«æŒ‰éˆ•åŠŸèƒ½
  shareBtn.addEventListener("click", () => {
    if (markers.length < 2) return;
    const start = markers[0].getPosition();
    const end = markers[1].getPosition();
    const shareUrl = `${window.location.origin}${window.location.pathname}?start=${start.lat()},${start.lng()}&end=${end.lat()},${end.lng()}`;
    prompt("åˆ†äº«é€£çµå¦‚ä¸‹ï¼ˆCtrl+Cè¤‡è£½çµ¦æœ‹å‹ï¼‰:", shareUrl);
  });
};
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAQjNbg6Zn4742aG9zNQc1T7UzK-DcW100&callback=initMap" async defer></script>
</body>
</html>
